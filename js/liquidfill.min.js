function liquidFillGaugeDefaultSettings(){return{minValue:0,maxValue:100,circleThickness:.05,circleFillGap:.05,circleColor:"#178BCA",waveHeight:.05,waveCount:1,waveRiseTime:1e3,waveAnimateTime:18e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.5,textSize:1,valueCountUp:!0,displayPercent:!0,textColor:"#045681",waveTextColor:"#A4DBf8"}}function loadLiquidFillGauge(t,a,e){null==e&&(e=liquidFillGaugeDefaultSettings());var n=d3.select("#"+t);console.log(n);var r,i=Math.min(parseInt(n.style("width")),parseInt(n.style("height")))/2,o=parseInt(n.style("width"))/2-i,l=parseInt(n.style("height"))/2-i,s=Math.max(e.minValue,Math.min(e.maxValue,a))/e.maxValue;r=e.waveHeightScaling?d3.scaleLinear().range([0,e.waveHeight,0]).domain([0,50,100]):d3.scaleLinear().range([e.waveHeight,e.waveHeight]).domain([0,100]);var u=e.textSize*i/2,d=parseFloat(a).toFixed(2),c=e.valueCountUp?e.minValue:d,m="",v=e.circleThickness*i,p=v+e.circleFillGap*i,f=i-p,x=f*r(100*s),w=2*f/e.waveCount,h=1+e.waveCount,g=w*h,F=function(t){return Math.round(t)};parseFloat(d)!=parseFloat(F(d))&&(F=function(t){return parseFloat(t).toFixed(1)}),parseFloat(d)!=parseFloat(F(d))&&(F=function(t){return parseFloat(t).toFixed(2)});for(var T=[],C=0;C<=40*h;C++)T.push({x:C/(40*h),y:C/40});var y=d3.scaleLinear().range([0,2*Math.PI]).domain([0,1]),M=d3.scaleLinear().range([0,i]).domain([0,i]),A=d3.scaleLinear().range([0,g]).domain([0,1]),L=d3.scaleLinear().range([0,x]).domain([0,1]),P=d3.scaleLinear().range([p+2*f+x,p-x]).domain([0,1]),R=d3.scaleLinear().range([0,g-2*f]).domain([0,1]),V=d3.scaleLinear().range([p+2*f,p+.7*u]).domain([0,1]),I=n.append("g").attr("transform","translate("+o+","+l+")"),G=d3.arc().startAngle(y(0)).endAngle(y(1)).outerRadius(M(i)).innerRadius(M(i-v));I.append("path").attr("d",G).style("fill",e.circleColor).attr("transform","translate("+i+","+i+")");var H=I.append("text").text(F(c)+m).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",u+"px").style("fill",e.textColor).attr("transform","translate("+i+","+V(e.textVertPosition)+")"),S=d3.area().x(function(t){return A(t.x)}).y0(function(t){return L(Math.sin(2*Math.PI*e.waveOffset*-1+2*Math.PI*(1-e.waveCount)+2*t.y*Math.PI))}).y1(function(t){return 2*f+x}),q=I.append("defs").append("clipPath").attr("id","clipWave"+t),z=q.append("path").datum(T).attr("d",S).attr("T",0),B=I.append("g").attr("clip-path","url(#clipWave"+t+")");B.append("circle").attr("cx",i).attr("cy",i).attr("r",f).style("fill",e.waveColor);var D=B.append("text").text(F(c)+m).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",u+"px").style("fill",e.waveTextColor).attr("transform","translate("+i+","+V(e.textVertPosition)+")");if(e.valueCountUp){var O=function(){var t=d3.interpolate(this.textContent,d);return function(a){this.textContent=F(t(a))+m}};H.transition().duration(e.waveRiseTime).tween("text",O),D.transition().duration(e.waveRiseTime).tween("text",O)}var U=p+2*f-g;function k(){z.attr("transform","translate("+R(z.attr("T"))+",0)"),z.transition().duration(e.waveAnimateTime*(1-z.attr("T"))).ease(d3.easeLinear).attr("transform","translate("+R(1)+",0)").attr("T",1).on("end",function(){z.attr("T",0),k(e.waveAnimateTime)})}return e.waveRise?q.attr("transform","translate("+U+","+P(0)+")").transition().duration(e.waveRiseTime).attr("transform","translate("+U+","+P(s)+")").on("start",function(){z.attr("transform","translate(1,0)")}):q.attr("transform","translate("+U+","+P(s)+")"),e.waveAnimate&&k(),new function(){this.update=function(t){var a=parseFloat(t).toFixed(2),n=function(t){return Math.round(t)};parseFloat(a)!=parseFloat(n(a))&&(n=function(t){return parseFloat(t).toFixed(1)}),parseFloat(a)!=parseFloat(n(a))&&(n=function(t){return parseFloat(t).toFixed(2)});var i=function(){var a=d3.interpolate(this.textContent,parseFloat(t).toFixed(2));return function(t){this.textContent=n(a(t))+m}};H.transition().duration(e.waveRiseTime).tween("text",i),D.transition().duration(e.waveRiseTime).tween("text",i);var o,l=Math.max(e.minValue,Math.min(e.maxValue,t))/e.maxValue,s=f*r(100*l),u=d3.scaleLinear().range([p+2*f+s,p-s]).domain([0,1])(l),d=d3.scaleLinear().range([0,g]).domain([0,1]),c=d3.scaleLinear().range([0,s]).domain([0,1]);o=e.waveHeightScaling?d3.area().x(function(t){return d(t.x)}).y0(function(t){return c(Math.sin(2*Math.PI*e.waveOffset*-1+2*Math.PI*(1-e.waveCount)+2*t.y*Math.PI))}).y1(function(t){return 2*f+s}):S;var v=e.waveAnimate?R(1):0;z.transition().duration(0).transition().duration(e.waveAnimate?e.waveAnimateTime*(1-z.attr("T")):e.waveRiseTime).ease(d3.easeLinear).attr("d",o).attr("transform","translate("+v+",0)").attr("T","1").on("end",function(){e.waveAnimate&&(z.attr("transform","translate("+R(0)+",0)"),k(e.waveAnimateTime))}),q.transition().duration(e.waveRiseTime).attr("transform","translate("+U+","+u+")")}}}